Market State Engine v0.1

A daily signal engine computing four binary market state indicators (UP/DOWN) from sector ETFs using simple moving average (SMA) relative strength.

**Signals:**
- **Energy**: XLE relative strength vs SPY
- **Rates**: TLT as yield proxy (UP = yields rising / tightening)
- **Tech**: XLK relative strength vs SPY
- **Utilities**: XLU relative strength vs SPY

**Architecture:**
- Python (canonical compute) → daily NDJSON records
- Node validator → recomputes & diffs against canonical output
- CI (GitHub Actions) → automated validation

Quickstart

1. Create and activate venv:

```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
```

2. Install dependencies:

```powershell
pip install -r requirements.txt
```

3. Run canonical compute on sample data:

```powershell
python -m src.python_mse.compute --input tests/sample/prices.csv --out data/canonical.ndjson
```

4. Run Node validator:

```powershell
node src/node_validator/validator.js --prices tests/sample/prices.csv --canonical data/canonical.ndjson --window 20
```

Expected output:
```
VALIDATOR: OK — no mismatches found
```

Testing

**Python unit tests:**
```powershell
pytest tests/python/ -v
```

**Node unit tests:**
```powershell
node tests/node/test_validator.js
```

CI/CD

GitHub Actions workflow (`.github/workflows/ci.yml`) runs:
1. Python canonical compute + unit tests
2. Node validator + unit tests
3. Diff validation (exit code 0 = pass, 1 = fail)

File Structure

```
├── PRD.md                          # Original specification
├── README.md                       # This file
├── requirements.txt                # Python dependencies
├── src/
│   ├── python_mse/                 # Canonical compute module
│   │   ├── __init__.py
│   │   ├── __main__.py
│   │   └── compute.py              # Core signal logic
│   └── node_validator/             # Node validator
│       ├── package.json
│       └── validator.js
├── data/                           # Outputs
│   ├── canonical.ndjson            # Generated by Python
├── tests/
│   ├── sample/
│   │   └── prices.csv              # Sample OHLCV data
│   ├── python/
│   │   └── test_compute.py
│   └── node/
│       └── test_validator.js
└── docs/                           # Project documentation
    ├── requirements.md
    └── architecture.md
```

v0.1 Scope

- 20-day SMA window (fixed)
- Binary signals only (UP / DOWN / NA)
- Daily frequency
- Sector ETF proxies (XLE, TLT, XLK, XLU)

Data requirements and enforcement

- The input `prices.csv` must represent adjusted close prices. Preferred column naming is `<TICKER>_adj_close` (for example `XLE_adj_close`).
- Backwards-compatibility: plain ticker columns like `XLE` are accepted but a runtime WARNING is emitted. For strict enforcement, provide files with `<TICKER>_adj_close` columns.

SMA NA policy

- If the SMA window is not yet filled (i.e. fewer than `window` observations), the signal value MUST be `NA` for that date. Both Python and Node validator follow this rule to guarantee consistent diffs.

v0.2 Planned

- Configurable windows (20/50/200)
- Multi-level strength scores
- Alternative yield curves for Rates
- Volatility and credit signals

